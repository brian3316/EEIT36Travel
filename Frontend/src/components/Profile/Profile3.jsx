import React from "react";
import { useRef, useState, useEffect } from "react";
import "./profile3.css";
import { Avatar, Button, Divider } from "@mui/material";
import Fab from '@mui/material/Fab'
import EditIcon from "@mui/icons-material/Edit";
import ProfileData from "./ProfileData";
import { getmemberallinfo } from "./getmemberinfo";
import BorderColorSharpIcon from "@mui/icons-material/BorderColorSharp";
import { getcityid } from "../Login/LoginFn";
import AddIcon from "@mui/icons-material/Add";
import ProfileUploadImg from "./ProfileUploadImg";
import { format, parseISO } from "date-fns";
// TODO :  City ID

export default function Profile3() {
  //Áî®Êà∂Ë≥áË®ä
  const emailref = useRef("");
  const nicknameref = useRef("");
  const realnameref = useRef("");
  const birthdayref = useRef("");
  const arearef = useRef("");
  const signref = useRef("");


  //ÁîüÊó•Êõ¥ÊîπÂç≥ÊôÇË≥áË®ä
  const [curbirth, setCurBirth] = useState("");

  //‰∏äÂÇ≥ÂúñÁâáÂ∞çË©±Á™ó
  const [open, setOpen] = useState(false)
  //‰øÆÊîπÁÖßÁâá
  const [showava, setShowAva] = useState(false);
  const [avasrc, setAvaSrc] = useState("")
  const [editfile, setEditFile] = useState("");
  //ÊòüÂ∫ß
  const [constellation, setConstellation] = useState("");

  //Áî®Êà∂ÁÖßÁâáURL
  let profileURL = localStorage.getItem("profileURL");

  //Áï∂ÂâçÁî®Êà∂ÊâÄÊúâË≥áË®ä
  const [memberinfo, setMemberInfo] = useState({});
  //Áï∂ÂâçÁî®Êà∂ÁîüÊó•
  const [currentbirth, setCurrentBirth] = useState("");
  //ÊÄßÂà•
  const [curgender, setCurGender] = useState("");
  //ÂüéÂ∏ÇID
  const [cityid, setCityId] = useState("");

  //gendername
  const [gendername, setGenderName] = useState("");




  useEffect(() => {
    //console.log("this is avasrc",avasrc);

    const gdata = async () => {
      const axiosmemberinfo = await getmemberallinfo(
        localStorage.getItem("email")
      );
      const axioscityid = await getcityid(axiosmemberinfo.memberid);
      //console.log(currentcityid);
      console.log("axiosmemberinfo", axiosmemberinfo.membergender);
      if (axiosmemberinfo.membergender === 0) {
        // console.log("this is test membergender 0:boy,1:girl", true);
        setGenderName("Áî∑Áîü");
      }
      else if (axiosmemberinfo.membergender === 1) {
        console.log("this is test membergender", false);
        setGenderName("Â•≥Áîü");
      }


      if (axiosmemberinfo.memberbirth != null) {

        const testbirth4 = await axiosmemberinfo.memberbirth;
        const testbirth5 = parseISO((testbirth4), "yyyy-MM-dd");
        const memberbirth2 = format(testbirth5, "yyyy-MM-dd");
        //console.log("this is testbirth5", testbirth5);


        setCurrentBirth(memberbirth2);

      }
      //


      //Ë®≠ÂÆöÁï∂ÂâçÁî®Êà∂ÊâÄÊúâË≥áË®ä
      const finalaxiosmemberinfo = Object.assign(axiosmemberinfo, { membercityid: axioscityid });
      console.log("Áï∂ÂâçÁî®Êà∂ÊâÄÊúâË≥áË®ä", finalaxiosmemberinfo);
      //console.log("Áï∂ÂâçÈ†ÅÈù¢ÁîüÊó•Ë≥áË®ä", birthdayref.current.value)
      //Ë®≠ÁΩÆÊÄßÂà•
      //setCurGender(finalaxiosmemberinfo.membergender);
      localStorage.setItem("testgendervalue", finalaxiosmemberinfo.membergender);
      setMemberInfo(finalaxiosmemberinfo);
      setCityId(() => (finalaxiosmemberinfo.membercityid).toString())

      return finalaxiosmemberinfo;
    };

    gdata();
  }, []);

  //  var d1 = new Date(memberinfo.memberbirth);
  //    let memberbirth2 = d1.toISOString().slice(0,10)
  //   console.log((memberinfo.memberbirth).toString().slice(0,10));

  //ËÉΩÂê¶‰øÆÊîπ
  const [edit, setEdit] = useState(false);

  const handleEdit = (e) => {
    e.preventDefault();
    setEdit(!edit);


  };




  const [profilesend, setProfileSend] = useState(false);

  const submitClick = async (e) => {
    e.preventDefault();
    setProfileSend(!profilesend);
  };

  //Âà§Êñ∑ÊòüÂ∫ß



  useEffect(() => {
    const month = parseInt((curbirth || currentbirth).substr(5, 2));
    const day = parseInt((curbirth || currentbirth).substr(8, 2));
    //console.log("ÂèäÊôÇÁîüÊó•Ë≥áË®ä",curbirth)
    // console.log("this is month", month);
    // console.log("this is day", day); 
    //console.log("ÊúàÔºö", month);
    //console.log("Êó•Êúü:", date.substr(8, 2));

    const conditionconstellation = () => {
      switch (month) {
        case 1:
          setConstellation(day < 21 ? `‚ôëÊë©ÁæØÂ∫ß` : `‚ôíÊ∞¥Áì∂Â∫ß`);

          break;
        case 2:
          setConstellation(day < 20 ? `‚ôíÊ∞¥Áì∂Â∫ß` : `‚ôìÈõôÈ≠öÂ∫ß`);
          break;
        case 3:
          setConstellation(day < 21 ? `‚ôìÈõôÈ≠öÂ∫ß` : `‚ôàÁâ°ÁæäÂ∫ß`);
          break;

        case 4:
          setConstellation(day < 21 ? `‚ôàÁâ°ÁæäÂ∫ß` : `‚ôâÈáëÁâõÂ∫ß`);
          break;
        case 5:
          setConstellation(day < 22 ? `‚ôâÈáëÁâõÂ∫ß` : `‚ôäÈõôÂ≠êÂ∫ß`);
          break;
        case 6:
          setConstellation(day < 22 ? `‚ôäÈõôÂ≠êÂ∫ß` : `‚ôãÂ∑®ËüπÂ∫ß`);
          break;
        case 7:
          setConstellation(day < 23 ? `‚ôãÂ∑®ËüπÂ∫ß` : `‚ôåÁçÖÂ≠êÂ∫ßü¶Å`);
          break;
        case 8:
          setConstellation(day < 24 ? `‚ôåÁçÖÂ≠êÂ∫ßü¶Å` : `‚ôçËôïÂ•≥Â∫ß`);
          break;
        case 9:
          setConstellation(day < 24 ? `‚ôçËôïÂ•≥Â∫ß` : `‚ôéÂ§©Áß§Â∫ß`);
          break;
        case 10:
          setConstellation(day < 24 ? `‚ôéÂ§©Áß§Â∫ß` : `‚ôèÂ§©Ë†çÂ∫ß`);
          break;
        case 11:
          setConstellation(day < 23 ? `‚ôèÂ§©Ë†çÂ∫ß` : `‚ôêÂ∞ÑÊâãÂ∫ß`);
          break;
        case 12:
          setConstellation(day < 22 ? `‚ôêÂ∞ÑÊâãÂ∫ß` : `‚ôëÊë©ÁæØÂ∫ß`);
          break;

        default:
          break;
      }
    };
    conditionconstellation();
    //Ë®≠ÁΩÆÁî®Êà∂ÊòüÂ∫ß
    //console.log("ÂèäÊôÇÁîüÊó•Ë≥áË®ä2",currentbirth);
    //console.log("ÂèäÊôÇÊòüÂ∫ßË≥áË®äÔºö",constellation);
  }, [curbirth, currentbirth]);


  return (
    <div
      style={{
        padding: "350px 300px 200px 440px",
        display: "flex",
        backgroundImage: 'url("/images/683602d049d4e3854580d5180cbbdaba.png")',
        backgroundSize: "100% 100%",
      }}
    >
      <div className="profile-container" style={{ fontSize: "1.5rem" }}>
        {profilesend && (
          <ProfileData
            profilesend={profilesend}
            setProfileSend={setProfileSend}
            emailref={emailref}
            nicknameref={nicknameref}
            realnameref={realnameref}
            curgender={curgender}
            birthdayref={birthdayref}
            arearef={arearef}
            signref={signref}
            profileURL={avasrc}
            editfile={editfile}
            setEdit={setEdit}
          />
        )}

        <form action="">
          <div className="row">
            <div className="background">
              <img
                className="profile3-backgroundimg"
                src="./img/1.jpg"
                alt=""
              />
            </div>

            <div className="profile3-img">
              <img className="avatarimg" src={edit ? (showava ? (!!avasrc === !!null ? profileURL : avasrc) : profileURL) : profileURL} alt="" />
              {/* {console.log("this is avasrc",!!avasrc === !!null)} */}
              <Fab
                aria-label="add"
                sx={{

                  backgroundColor: '#7c5b41',
                  textShadow: ' 4px 4px 3px rgba(77, 77, 77, 0.5)',
                  cursor: 'pointer',
                  '&:hover': { backgroundColor: '#332a1a' },
                  '&:active': { backgroundColor: 'black', color: 'ActiveBorder' }
                }}
                disabled={edit ? "" : "disabled"}
                onClick={() => setOpen(true)}
              >
                <AddIcon style={{ color: 'whitesmoke' }} />
              </Fab>
              {open && <ProfileUploadImg open={open} setOpen={setOpen} setShowAva={setShowAva} setAvaSrc={setAvaSrc} setEditFile={setEditFile} />}
            </div>
          </div>
          <div className="profile-editbtn">
            <button
              className="profile-editbtn"
              style={{
                border: "none",
                backgroundColor: "transparent",
                justifyContent: "right",
              }}
              onClick={handleEdit}
            >
              <BorderColorSharpIcon sx={{ color: edit ? "red" : "black" }} />
            </button>
          </div>
          <div className="profile3-row">
            <div className="col-25">
              <label className="profile-label" htmlFor="email">
                ÈõªÂ≠ê‰ø°ÁÆ±Ôºö
              </label>
            </div>

            <div className="col-75">
              <input
                type="email"
                id="email"
                className="email"
                name="firstname"
                disabled="disabled"
                placeholder="Your email.."
                value={localStorage.getItem("email")}
                ref={emailref}
              />
            </div>
          </div>
          <div className="profile3-row">
            <div className="col-25">
              <label className="profile-label" htmlFor="nickname">
                Êö±Á®±Ôºö
              </label>
            </div>
            <div className="col-75">
              <input
                type="text"
                required
                defaultValue={memberinfo.membernickname}
                ref={nicknameref}
                disabled={edit ? null : "disabled"}
                className="text"
                id="nickname"
                name="nickname"
                placeholder="Êö±Á®±..."
              />
            </div>
          </div>
          <div className="profile3-row">
            <div className="col-25">
              <label className="profile-label" htmlFor="fname">
                ÂßìÂêçÔºö
              </label>
            </div>
            <div className="col-75">
              <input
                type="text"
                disabled={edit ? null : "disabled"}
                defaultValue={memberinfo.membername}
                ref={realnameref}
                className="text"
                id="fname"
                name="firstname"
                placeholder="ÂßìÂêç..."
              />
            </div>
          </div>

          <div className="profile3-row">
            <div className="col-25">
              <label className="profile-label" htmlFor="birthday">
                ÁîüÊó•Ôºö
              </label>
            </div>
            <div className="col-75">
              <input
                disabled={edit ? null : "disabled"}
                defaultValue={currentbirth}
                className="profile-date"
                type="date"
                ref={birthdayref}
                onChange={(e) => setCurBirth(e.target.value)}
                id="birthday"
                name="lastname"
                placeholder="Your last name.."
              />
            </div>
          </div>
          <div>
            <div>
              <label style={{ display: edit ? "" : "none" }}>ÊÄßÂà•Ôºö</label>
            </div>
            <div className="profile3-editcurusergender" style={{ marginLeft: "230px", marginTop: "-40px", display: (edit ? "" : "none") }}>


              <input
                disabled={edit ? null : "disabled"}
                // defaultChecked={localStorage.getItem("testgendervalue") === 0 && true}
                onChange={(e) => {
                  setCurGender(e.target.value)
                  console.log(e.target.value);
                }}
                {...(gendername === "Áî∑Áîü" && { defaultChecked: true, value: "0" })}

                type="radio"
                id="r1"
                name="gender"
                value="0"

              />

              <label htmlFor="r1">
                <span>Áî∑Áîü</span>
              </label>
              <input
                type="radio"
                //defaultChecked={(memberinfo.membergender) ===1}
                disabled={edit ? null : "disabled"}
                value="1"

                id="r2"
                {...(gendername === "Â•≥Áîü" && { defaultChecked: true, value: "1" })}
                onChange={(e) => setCurGender(e.target.value)}
                name="gender"
                style={{ marginLeft: "80px" }}
              />
              <label htmlFor="r2">
                <span>Â•≥Áîü</span>
              </label>

            </div>
            <div className="profile3-curusergender" style={{ display: (edit ? "none" : "") }}>
              {memberinfo.membergender != null ? <>Áï∂ÂâçÊÄßÂà•Ôºö<span style={{ marginLeft: '120px' }}>{(memberinfo.membergender) === 1 ? "Â•≥Áîü" : "Áî∑Áîü"}</span></> : ""}
            </div>
            {console.log((memberinfo.membergender === 1 ? "Â•≥Áîü" : "Áî∑Áîü"))}
          </div>
          <div>

          </div>
          <div className="profile3-row">
            <div className="col-25">
              <label className="profile-label" htmlFor="constellations ">
                ÊòüÂ∫ßÔºö
              </label>
            </div>
            <div className="col-75">
              <input
                value={constellation}

                defaultValue={constellation}
                disabled="disabled"
                type="text"
                className="text"
                id="constellations "
                name="constellations "
                placeholder="ÊòüÂ∫ß..."
              />
            </div>
          </div>
          <div className="profile3-row">
            <div className="col-25">
              <label className="profile-label" htmlFor="area">
                Âú∞ÂçÄÔºö
              </label>
            </div>
            <div className="col-75">

              <select
                id="area"
                name="country"
                ref={arearef}
                value={edit ? null : cityid}
                //defaultValue={edit ? null : cityid}
                disabled={edit ? null : "disabled"}
              >
                <optgroup label="Âåó">
                  <option value="1">Âü∫ÈöÜÂ∏Ç</option>
                  <option value="2">Ëá∫ÂåóÂ∏Ç</option>
                  <option value="3">Êñ∞ÂåóÂ∏Ç</option>

                  <option value="4">Ê°ÉÂúíÂ∏Ç</option>
                  <option value="5">Êñ∞Á´πÂ∏Ç</option>
                  <option value="6">Êñ∞Á´πÁ∏£</option>

                  <option value="19">ÂÆúËò≠Á∏£</option>
                </optgroup>
                <optgroup label="‰∏≠">
                  <option value="7">ËãóÊ†óÁ∏£</option>
                  <option value="8">Ëá∫‰∏≠Â∏Ç</option>
                  <option value="9">ÂΩ∞ÂåñÁ∏£</option>
                  <option value="10">ÂçóÊäïÁ∏£</option>
                </optgroup>
                <optgroup label="Âçó">
                  <option value="11">Èõ≤ÊûóÁ∏£</option>
                  <option value="12">ÂòâÁæ©Â∏Ç</option>
                  <option value="13">ÂòâÁæ©Á∏£</option>
                  <option value="14">Âè∞ÂçóÂ∏Ç</option>
                  <option value="15">È´òÈõÑÂ∏Ç</option>
                  <option value="16">Â±èÊù±Á∏£</option>
                </optgroup>
                <optgroup label="Êù±">
                  <option value="17">Âè∞Êù±Á∏£</option>

                  <option value="18">Ëä±ËìÆÁ∏£</option>
                </optgroup>
                <optgroup label="Èõ¢Â≥∂">
                  <option value="20">ÊæéÊπñÁ∏£</option>
                  <option value="21">ÈáëÈñÄÁ∏£</option>
                  <option value="22">ÈÄ£Ê±üÁ∏£</option>
                </optgroup>
              </select>
            </div>
          </div>
          <div className="profile3-row">
            <div className="col-25">
              <label className="profile-label" htmlFor="sign">
                ÂÄãÊÄßÁ∞ΩÂêçÔºö
              </label>
            </div>
            <div className="col-75">
              <textarea
                defaultValue={memberinfo.memberintro}
                id="sign"
                disabled={edit ? null : "disabled"}
                ref={signref}
                name="sign"
                placeholder="ÂØ´‰∫õÁâπÂà•ÁöÑÂêß ..."
                style={{ height: "200px" }}
              ></textarea>
            </div>
          </div>
          <br />
          <br />
          <br />

          <div
            className="profile3-row"
            style={{
              display: "flex",
              textAlign: "center",
              justifyContent: "center",
            }}
          >
            <input
              disabled={edit ? null : "disabled"}
              className={edit ? "profile3-submit" : "profile3-notsubmit"}
              type="submit"
              value="ÈÄÅÂá∫"
              onClick={submitClick}
            />
          </div>
        </form>
        <Divider sx={{ color: "black" }} />
      </div>
    </div>

  );
}